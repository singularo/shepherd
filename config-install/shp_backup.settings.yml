root_dir: /backup
backup_title: '[current-date:medium] - [shepherd:environment-type]'
backup_command: "echo \"Ensuring backup destination directories exist\"\r\nmkdir -p [shepherd:backup-path]/files\r\nmkdir -p [shepherd:backup-path]/private\r\necho \"Backing up public files\"\r\nrsync -a [shepherd:site-public-files] [shepherd:backup-path]/files/\r\necho \"Backing up private files\"\r\nrsync -a [shepherd:site-private-files] [shepherd:backup-path]/private/\r\necho \"Backing up database\"\r\ndrush -r web sql-dump --structure-tables-list=cache_bootstrap,cache_config,cache_container,cache_data,cache_default,cache_discovery,cache_dynamic_page_cache,cache_entity,cache_menu,cache_render,cache_rest,cache_toolbar,cachetags --result-file=[shepherd:backup-path]/database.sql\r\necho \"Backup complete\"\r\n"
restore_command: "echo \"Dropping database\"\r\ndrush -y -r web sql-drop\r\necho \"Restoring database from backup\"\r\ndrush -r web sqlq --file=[shepherd:backup-path]/database.sql\r\necho \"Restoring files\"\r\nrsync -a --delete [shepherd:backup-path]/files/ [shepherd:site-public-files] || true\r\necho \"Restoring private files\"\r\nrsync -a --delete [shepherd:backup-path]/private/ [shepherd:site-private-files] || true\r\necho \"Applying drupal updates\"\r\ndrush -r web updb --entity-updates -y || true\r\necho \"Clearing cache\"\r\ndrush -r web cr\r\necho \"Restore complete\"\r\n"
_core:
  default_config_hash: XUa0Nvk6x9WfhqPBqH07RQkeHlmnxJ_8wTG0nGZguUs
